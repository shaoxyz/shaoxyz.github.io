<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>æ‰¶æˆ‘èµ·æ¥ï¼Œæˆ‘è¿˜èƒ½å†ä¼˜åŒ–ä¸€ä¸‹ä»£ç </title>
    <url>/2020/07/10/%E6%89%B6%E6%88%91%E8%B5%B7%E6%9D%A5%EF%BC%8C%E6%88%91%E8%BF%98%E8%83%BD%E5%86%8D%E4%BC%98%E5%8C%96%E4%B8%80%E4%B8%8B%E4%BB%A3%E7%A0%81/</url>
    <content><![CDATA[<h1 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h1><p>é¢è¯•å®˜è€ç‹ï¼šç»™ä½ å‡ºä¸€é“é¢˜å§ï¼Œå¾ˆç®€å•ï¼Œç»Ÿè®¡å­—ç¬¦ä¸²ä¸­å„ä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°</p>
<p>æ±‚èŒè€…å°æï¼šå—¯ï¼Œå¥½çš„ï¼</p>
<p>( äºæ˜¯å°æå¼€å§‹è¾“å‡º..</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counte...</span><br></pre></td></tr></table></figure>


<p>è€ç‹æ‰“æ–­å°æï¼šemm.. ä¸ï¼Œä¸è¦ç”¨Counter</p>
<p>å°æè¢«æ‰“æ–­æœ‰ç‚¹æ…Œï¼šå•Šå¥½çš„</p>
<p>è€ç‹æ¸©é¦¨æé†’ï¼šå°±ç”¨å­—å…¸å§</p>
<p>å°æè¯§å¼‚å¿ƒæƒ³ï¼šå°±è¿™ï¼Ÿ</p>
<p>( äºæ˜¯å°æåˆå¼€å§‹è¾“å‡º..</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">(s)</span>:</span></span><br><span class="line">    res = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> res:</span><br><span class="line">            res[i] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res[i] += <span class="number">1</span></span><br><span class="line">    print(res)</span><br></pre></td></tr></table></figure>


<p>è€ç‹ï¼šå—¯ï¼Œå¥½ï¼Œé‚£ä½ åˆ†æä¸€ä¸‹å¤æ‚åº¦å§</p>
<p>å°æå¿ƒæƒ³ï¼Œè¿™æœ‰ä»€ä¹ˆå¥½åˆ†æçš„ï¼Œä¸å°±O(n)ä¹ˆï¼Ÿå°æååˆ†è‚¯å®šç­”ï¼šO(N)!</p>
<p>è€ç‹ï¼šem..è¿˜æœ‰ä¼˜åŒ–çš„ç©ºé—´å—ï¼Ÿ</p>
<p>å°æåˆçœ‹äº†ä¸€çœ¼ä»£ç ï¼Œè‡ªå·±å˜€å’•ï¼šå¿…é¡»æ‰«ä¸€éæ‰€æœ‰å­—ç¬¦ï¼Œé‚£O(N)è¿˜èƒ½æ€ä¹ˆä¼˜åŒ–ï¼Œé¢è¯•å®˜è«ä¸æ˜¯åœ¨ææˆ‘ï¼Ÿ</p>
<p>æ°”æ°›æœ‰ç‚¹å°´å°¬ï¼Œå°ææ€ä¹ˆä¹Ÿæƒ³ä¸å‡ºæ¥è¿˜èƒ½æ€ä¹ˆä¼˜åŒ–.. </p>
<p>â€¦<br>â€¦<br>â€¦</p>
<h1 id="è§£ç­”"><a href="#è§£ç­”" class="headerlink" title="è§£ç­”"></a>è§£ç­”</h1><blockquote>
<p><strong>è¿˜å¯ä»¥å†å‡å°‘ä¸€æ¬¡å¯¹resçš„æŸ¥è¯¢</strong></p>
</blockquote>
<p>å…ˆæ¥åˆ†æåˆ†ææœ€åˆçš„å†™æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">(s)</span>:</span></span><br><span class="line">    res = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> res: <span class="comment"># ç¬¬ä¸€æ¬¡æŸ¥res</span></span><br><span class="line">            res[i] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res[i] += <span class="number">1</span> <span class="comment"># ç­‰ä»·äº`res[i] = res[i] + 1` ç¬¬äºŒæ¬¡æŸ¥res</span></span><br><span class="line">    print(res)</span><br></pre></td></tr></table></figure>


<p>ç¬¬ä¸€ç§å†™æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">(s)</span>:</span></span><br><span class="line">    res = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        res[i] = res.get(i, <span class="number">0</span>) + <span class="number">1</span> <span class="comment"># åªæŸ¥äº†ä¸€æ¬¡res</span></span><br><span class="line">    print(res)</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒç§å†™æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count2</span><span class="params">(s)</span>:</span></span><br><span class="line">    res = defaultdict(int)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        res[i] += <span class="number">1</span> <span class="comment"># åªæŸ¥äº†ä¸€æ¬¡res</span></span><br><span class="line">    print(res)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>SQLè”è¡¨æŸ¥è¯¢è¾…åŠ©è¡¨å»é‡</title>
    <url>/2020/07/16/SQL%E8%81%94%E8%A1%A8%E6%9F%A5%E8%AF%A2%E8%BE%85%E5%8A%A9%E8%A1%A8%E5%8E%BB%E9%87%8D/</url>
    <content><![CDATA[<p>è€ä¸œå®¶è¿è¥å¦¹å­è¦åšæ•°æ®åˆ†ææçš„ä¸€ä¸ªéœ€æ±‚</p>
<p>ç»Ÿè®¡æ‰€æœ‰ç”¨æˆ·åœ¨æ³¨å†Œå½“å¤©æ˜¯å¦å®Œæˆè¿‡æ¶ˆè´¹</p>
<p>æ¶‰åŠç”¨æˆ·è¡¨å’Œè®¢å•è¡¨çš„è”è¡¨æŸ¥è¯¢, ä¸»è¦å­—æ®µä¸ºç”¨æˆ·idï¼Œæ³¨å†Œæ—¶é—´ï¼Œç¬¬ä¸€ç¬”æ¶ˆè´¹æ—¶é—´</p>
<p>æˆ‘ä»¬çš„MySQLç‰ˆæœ¬æ˜¯5.7.18</p>
<p>å…ˆè¯´é‡åˆ°çš„é—®é¢˜</p>
<p>é¦–å…ˆï¼Œç”¨ <code>GROUP BY</code> ä¼šè§¦å‘ <a href="https://dev.mysql.com/doc/refman/5.7/en/sql-mode.html#sqlmode_only_full_group_by" target="_blank" rel="noopener"><code>ONLY_FULL_GROUP_BY</code></a></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> u.id, u.created_at, o.created_at </span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">user</span> u </span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> o.buyer_id = user.id <span class="keyword">AND</span> o.state = <span class="number">1</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> o.buyer_id</span><br></pre></td></tr></table></figure>
<p>ç®€å•æ¥è¯´ï¼ŒMySQL5.7.5ä¹‹åï¼ŒSQLéœ€è¦æ£€æµ‹å‡½æ•°ä¾èµ–å…³ç³»ï¼Œ<code>SELECT</code> &amp; <code>ORDER BY</code> &amp; <code>HAVING</code> ä¸èƒ½å¼•ç”¨éèšåˆåˆ—</p>
<p>ä¹‹æ‰€ä»¥è¦è¿™ä¹ˆåšæ˜¯ä¸ºäº†é¿å…å½“å‡ºç°ä¸æ­£ç¡®å’Œä¸å¯é¢„æµ‹çš„æŸ¥è¯¢ç»“æœæ—¶MySQLæ²¡æœ‰ä»»ä½•æŠ¥é”™å’Œè­¦å‘Šï¼Œè¿™é‡Œæœ‰<a href="https://mysqlserverteam.com/mysql-5-7-only_full_group_by-improved-recognizing-functional-dependencies-enabled-by-default/" target="_blank" rel="noopener">å…·ä½“ä¾‹å­ä¸è¯´æ˜</a></p>
<p>å†è€…ï¼Œç”¨<code>MIN</code> ||  <code>MAX</code> || <code>ANY_VALUE</code>å°†éèšåˆåˆ—åŒ…èµ·æ¥ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œä½†å®æµ‹åœ¨æ•°æ®é‡è¾ƒå¤§çš„æƒ…å†µä¸‹å¾ˆæ…¢ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MIN</span>(u.id), <span class="keyword">MIN</span>(u.created_at), <span class="keyword">MIN</span>(o.created_at) </span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">user</span> u <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> o.buyer_id = u.id <span class="keyword">AND</span> o.state = <span class="number">1</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> o.buyer_id</span><br></pre></td></tr></table></figure>
<p>æ¨æµ‹æ˜¯è¿™ä¹ˆåšä¾ç„¶æ²¡æœ‰çœŸæ­£æ„ä¹‰ä¸Šçš„å»é‡ï¼Œè€Œæ˜¯ç±»ä¼¼ä¸æŠŠåŸæ¥çš„æŸ¥è¯¢ä½œä¸ºå­æŸ¥è¯¢åˆè¿‡æ»¤äº†ä¸€é</p>
<p>æƒ³è¦çš„æ•ˆæœæ˜¯ï¼šç›´æ¥é™åˆ¶è¾…åŠ©è¡¨åªå–ä¸€è¡Œ</p>
<p>åœ¨<a href="https://stackoverflow.com/questions/11885394/mysql-join-with-limit-1/11885521#11885521" target="_blank" rel="noopener">stackoverflow</a>ä¸Šæ‰¾åˆ°äº†æœ€ä½³ç­”æ¡ˆ</p>
<p>æœ€åä¿®æ”¹SQLå¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    user.id, </span><br><span class="line">    <span class="keyword">CASE</span> </span><br><span class="line">        <span class="keyword">WHEN</span> <span class="built_in">DATE</span>(o.created_at) = <span class="built_in">DATE</span>(u.created_at) <span class="keyword">THEN</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">AS</span> <span class="string">'æ˜¯å¦åœ¨æ³¨å†Œå½“å¤©è´­ä¹°'</span>, </span><br><span class="line">    <span class="built_in">DATE</span>(u.created_at) <span class="keyword">AS</span> <span class="string">'æ³¨å†Œæ—¶é—´'</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">user</span> u</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> o.id = ( <span class="comment"># æ³¨æ„è¿™é‡Œå¿…é¡»æ˜¯ä¸»é”®</span></span><br><span class="line">    <span class="keyword">SELECT</span> o2.id</span><br><span class="line">    <span class="keyword">FROM</span> orders o2</span><br><span class="line">    <span class="keyword">WHERE</span> o2.buyer_id = u.id</span><br><span class="line">        <span class="keyword">AND</span> o2.state = <span class="number">1</span></span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> o2.id</span><br><span class="line">    <span class="keyword">LIMIT</span> <span class="number">1</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>ç”¨æˆ·è¡¨30w<br>è®¢å•è¡¨70w<br>æ—¶é—´å¤§æ¦‚åœ¨10ï½20ms, å¯ä»¥æ¥å—<br><img src="/images/left-join-limit-1.png" width="50%" ></p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>SQL</tag>
      </tags>
  </entry>
  <entry>
    <title>hello world</title>
    <url>/2020/05/21/hello-world/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Pythonå®ç°ç­–ç•¥æ¨¡å¼</title>
    <url>/2020/07/13/Python%E5%AE%9E%E7%8E%B0%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<p>è¿™æ˜¯æœ€è¿‘æ±‚èŒç¢°åˆ°çš„ä¸€é“çœŸå®ç¬”è¯•é¢˜ï¼ŒHRæŠŠé¢˜ç›®å‘æ¥åï¼Œå®Œæ•´çš„ç¼–ç èŠ±äº†å¤§åŠä¸ªä¸‹åˆï¼Œæ ¼å¼åŒ–è¾“å‡ºå®åœ¨æ˜¯æœ‰ç‚¹éº»çƒ¦<br>è¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šé¢˜</p>
<h1 id="æ¶æ„å°æ“ç»ƒ"><a href="#æ¶æ„å°æ“ç»ƒ" class="headerlink" title="æ¶æ„å°æ“ç»ƒ"></a>æ¶æ„å°æ“ç»ƒ</h1><h2 id="éœ€æ±‚æè¿°"><a href="#éœ€æ±‚æè¿°" class="headerlink" title="éœ€æ±‚æè¿°"></a>éœ€æ±‚æè¿°</h2><p>æŸå¿«é¤å“ç‰Œæ¨å‡ºäº†å®ƒç‹¬å®¶çš„å¤–å–åº”ç”¨ï¼Œç”¨æˆ·å¯ä»¥åœ¨æ‰‹æœºä¸Šç›´æ¥ä¸‹å•ã€‚è¯¥åº”ç”¨ä¼šæ ¹æ®ç”¨æˆ·é€‰æ‹©çš„èœå“(Item)ã€æ•°é‡(Count)å’Œä¼˜æƒ æ–¹å¼(Promotion)è¿›è¡Œè®¡ç®—ï¼Œå‘Šè¯‰ç”¨æˆ·éœ€è¦æ”¯ä»˜çš„é‡‘é¢(Charge)ã€‚</p>
<p>ä¼˜æƒ æ´»åŠ¨æœ‰å¤šç§å½¢å¼ã€‚å‡è®¾ç”¨æˆ·ä¸€æ¬¡åªèƒ½ä½¿ç”¨ä¸€ç§ä¼˜æƒ ï¼Œé‚£ä¹ˆä½¿ç”¨å“ªç§ä¼˜æƒ çœé’±æœ€å¤šå°±ä¼šæ˜¯ä¸€ä¸ªè®©ç”¨æˆ·å¤´ç–¼çš„é—®é¢˜ã€‚æ‰€ä»¥è¯¥å¤–å–åº”ç”¨ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ï¼Œåœ¨ç”¨æˆ·ä¸‹å•æ—¶ï¼Œä¼šè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æƒ çš„æ–¹å¼å¹¶è®¡ç®—å‡ºæœ€ç»ˆé‡‘é¢è®©ç”¨æˆ·ç¡®è®¤ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªåä¸º<code>bestCharge</code>çš„å‡½æ•°ï¼Œå®ƒèƒ½å¤Ÿæ¥æ”¶ç”¨æˆ·é€‰æ‹©çš„èœå“å’Œæ•°é‡ï¼ˆä»¥ç‰¹å®šæ ¼å¼å‘ˆç°ï¼‰ä½œä¸ºè¾“å…¥ï¼Œç„¶åè¿”å›è®¡ç®—åçš„æ±‡æ€»ä¿¡æ¯ã€‚</p>
<p>å·²çŸ¥ï¼š</p>
<ul>
<li>è¯¥åº—çš„èœå“æ¯ä¸€ä¸ªéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„id</li>
<li>å½“å‰çš„ä¼˜æƒ æ–¹å¼æœ‰:<ul>
<li>æ»¡30å‡6å…ƒ</li>
<li>æŒ‡å®šèœå“åŠä»·</li>
</ul>
</li>
<li>é™¤èœå“å¤–æ²¡æœ‰å…¶å®ƒæ”¶è´¹ï¼ˆå¦‚é€é¤è´¹ã€é¤ç›’è´¹ç­‰ï¼‰</li>
<li>å¦‚æœä¸¤ç§ä¼˜æƒ æ–¹å¼çœé’±ä¸€æ ·å¤šï¼Œåˆ™ä½¿ç”¨å‰ä¸€ç§ä¼˜æƒ æ–¹å¼</li>
</ul>
<h2 id="è¾“å…¥æ ·ä¾‹"><a href="#è¾“å…¥æ ·ä¾‹" class="headerlink" title="è¾“å…¥æ ·ä¾‹"></a>è¾“å…¥æ ·ä¾‹</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">[<span class="string">"ITEM0001 x 1"</span>, <span class="string">"ITEM0013 x 2"</span>, <span class="string">"ITEM0022 x 1"</span>]</span><br></pre></td></tr></table></figure>

<h2 id="è¾“å‡ºæ ·ä¾‹"><a href="#è¾“å‡ºæ ·ä¾‹" class="headerlink" title="è¾“å‡ºæ ·ä¾‹"></a>è¾“å‡ºæ ·ä¾‹</h2><figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">============= è®¢é¤æ˜ç»† =============</span><br><span class="line">é»„ç„–é¸¡ x 1 = 18å…ƒ</span><br><span class="line">è‚‰å¤¹é¦ x 2 = 12å…ƒ</span><br><span class="line">å‡‰çš® x 1 = 8å…ƒ</span><br><span class="line">-----------------------------------</span><br><span class="line">ä½¿ç”¨ä¼˜æƒ :</span><br><span class="line">æŒ‡å®šèœå“åŠä»·(é»„ç„–é¸¡ï¼Œå‡‰çš®)ï¼Œçœ13å…ƒ</span><br><span class="line">-----------------------------------</span><br><span class="line">æ€»è®¡ï¼š25å…ƒ</span><br><span class="line">===================================</span><br></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨å¦ä¸€ç§ä¼˜æƒ çš„æ ·ä¾‹"><a href="#ä½¿ç”¨å¦ä¸€ç§ä¼˜æƒ çš„æ ·ä¾‹" class="headerlink" title="ä½¿ç”¨å¦ä¸€ç§ä¼˜æƒ çš„æ ·ä¾‹"></a>ä½¿ç”¨å¦ä¸€ç§ä¼˜æƒ çš„æ ·ä¾‹</h2><p>è¾“å…¥ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">[<span class="string">"ITEM0013 x 4"</span>, <span class="string">"ITEM0022 x 1"</span>]</span><br></pre></td></tr></table></figure>


<p>è¾“å‡ºï¼š</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">============= è®¢é¤æ˜ç»† =============</span><br><span class="line">è‚‰å¤¹é¦ x 4 = 24å…ƒ</span><br><span class="line">å‡‰çš® x 1 = 8å…ƒ</span><br><span class="line">-----------------------------------</span><br><span class="line">ä½¿ç”¨ä¼˜æƒ :</span><br><span class="line">æ»¡30å‡6å…ƒï¼Œçœ6å…ƒ</span><br><span class="line">-----------------------------------</span><br><span class="line">æ€»è®¡ï¼š26å…ƒ</span><br><span class="line">===================================</span><br></pre></td></tr></table></figure>

<h2 id="å¦‚æœæ²¡æœ‰ä¼˜æƒ å¯äº«å—"><a href="#å¦‚æœæ²¡æœ‰ä¼˜æƒ å¯äº«å—" class="headerlink" title="å¦‚æœæ²¡æœ‰ä¼˜æƒ å¯äº«å—"></a>å¦‚æœæ²¡æœ‰ä¼˜æƒ å¯äº«å—</h2><p>è¾“å…¥ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">[<span class="string">"ITEM0013 x 4"</span>]</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">============= è®¢é¤æ˜ç»† =============</span><br><span class="line">è‚‰å¤¹é¦ x 4 = 24å…ƒ</span><br><span class="line">-----------------------------------</span><br><span class="line">æ€»è®¡ï¼š24å…ƒ</span><br><span class="line">===================================</span><br></pre></td></tr></table></figure>

<h1 id="ç­”æ¡ˆ"><a href="#ç­”æ¡ˆ" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h1><p>çœ‹åˆ°é¢˜å°±æ„Ÿè§‰ä¼¼æ›¾ç›¸è¯†ï¼Œå‚è€ƒæµç•…çš„Pythonç¬¬å…­ç« </p>
<img src="/images/strategy.png">

<p>å¥½äº†ï¼ŒæŠŠæœ•çš„ğŸç‰µä¸Šæ¥ï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">@version: python3.7</span></span><br><span class="line"><span class="string">@author: shaoxyz</span></span><br><span class="line"><span class="string">@file: strategy.py</span></span><br><span class="line"><span class="string">@time: 2020-07-01 18:54</span></span><br><span class="line"><span class="string">@desc: æ“ç»ƒç­–ç•¥æ¨¡å¼</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> textwrap</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Dict</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">èœå“å±æ€§è¯´æ˜</span></span><br><span class="line"><span class="string">item = &#123;</span></span><br><span class="line"><span class="string">    _id: &lt;INCR&gt;,        # è‡ªå¢id</span></span><br><span class="line"><span class="string">    name: str,          # èœå“å</span></span><br><span class="line"><span class="string">    price: int,         # å•ä»·ï¼Œå•ä½:åˆ†</span></span><br><span class="line"><span class="string">    is_half_price: bool # æ˜¯å¦åŠä»·</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">"ITEM0001"</span>: &#123;<span class="string">"_id"</span>: <span class="number">1</span>, <span class="string">"name"</span>: <span class="string">"é»„ç„–é¸¡"</span>, <span class="string">"price"</span>: <span class="number">1800</span>, <span class="string">"is_half_price"</span>: <span class="literal">True</span>&#125;,</span><br><span class="line">    <span class="string">"ITEM0002"</span>: &#123;<span class="string">"_id"</span>: <span class="number">2</span>, <span class="string">"name"</span>: <span class="string">"è›‹ç‚’é¥­"</span>, <span class="string">"price"</span>: <span class="number">1500</span>, <span class="string">"is_half_price"</span>: <span class="literal">False</span>&#125;,</span><br><span class="line">    <span class="string">"ITEM0003"</span>: &#123;<span class="string">"_id"</span>: <span class="number">3</span>, <span class="string">"name"</span>: <span class="string">"ç‰›è‚‰é¢"</span>, <span class="string">"price"</span>: <span class="number">2200</span>, <span class="string">"is_half_price"</span>: <span class="literal">True</span>&#125;,</span><br><span class="line">    <span class="string">"ITEM0004"</span>: &#123;<span class="string">"_id"</span>: <span class="number">4</span>, <span class="string">"name"</span>: <span class="string">"ä¸œåŒ—é¥ºå­"</span>, <span class="string">"price"</span>: <span class="number">1800</span>, <span class="string">"is_half_price"</span>: <span class="literal">False</span>&#125;,</span><br><span class="line">    <span class="string">"ITEM0013"</span>: &#123;<span class="string">"_id"</span>: <span class="number">13</span>, <span class="string">"name"</span>: <span class="string">"è‚‰å¤¹é¦"</span>, <span class="string">"price"</span>: <span class="number">600</span>, <span class="string">"is_half_price"</span>: <span class="literal">True</span>&#125;,</span><br><span class="line">    <span class="string">"ITEM0022"</span>: &#123;<span class="string">"_id"</span>: <span class="number">22</span>, <span class="string">"name"</span>: <span class="string">"å‡‰çš®"</span>, <span class="string">"price"</span>: <span class="number">800</span>, <span class="string">"is_half_price"</span>: <span class="literal">True</span>&#125;,</span><br><span class="line">    <span class="string">"ITEM0023"</span>: &#123;</span><br><span class="line">        <span class="string">"_id"</span>: <span class="number">23</span>,</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"è¶…çº§æ— æ•Œæµ·é²œéœ¸ç‹æ‹…æ‹…é¢ä¹‹è¶…çº§æ— æ•Œæµ·é²œéœ¸ç‹æ‹…æ‹…é¢"</span>,</span><br><span class="line">        <span class="string">"price"</span>: <span class="number">3000</span>,</span><br><span class="line">        <span class="string">"is_half_price"</span>: <span class="literal">True</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## Exception</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObjectDoesNotExist</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="string">"""The requested object does not exist"""</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InvalidParams</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="string">"""Invalid parameters"""</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmptyInput</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="string">"""Invalid parameters"""</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## Obj</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Item</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, item_id, count)</span>:</span></span><br><span class="line">        self.item_info = data.get(item_id)</span><br><span class="line">        <span class="keyword">if</span> self.item_info <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> ObjectDoesNotExist(<span class="string">f"ä¸å­˜åœ¨èœå“: <span class="subst">&#123;item_id&#125;</span>"</span>)</span><br><span class="line">        self.count = count</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">price</span><span class="params">(self)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> self.item_info.get(<span class="string">"price"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name</span><span class="params">(self)</span> -&gt; str:</span></span><br><span class="line">        <span class="keyword">return</span> self.item_info.get(<span class="string">"name"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_half_price</span><span class="params">(self)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">return</span> self.item_info.get(<span class="string">"is_half_price"</span>, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">total</span><span class="params">(self)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> self.price * self.count</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span>:</span></span><br><span class="line">    _lock = threading.RLock()  <span class="comment"># æ— è®ºç±»æœ‰å¤šå°‘ä¸ªå®ä¾‹ï¼Œéƒ½ç”¨ä¸€ä¸ªé”</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, promotion=None)</span>:</span></span><br><span class="line">        self.basket = []</span><br><span class="line">        self.promotion = promotion</span><br><span class="line">        self.half_price_items = set()</span><br><span class="line"></span><br><span class="line">        self._final_promotion = <span class="literal">None</span></span><br><span class="line">        self._discount = <span class="number">0</span></span><br><span class="line">        self._finished = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_to_basket</span><span class="params">(self, *items)</span>:</span></span><br><span class="line">        <span class="keyword">with</span> Order._lock:</span><br><span class="line">            self._finished = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">                self.basket.append(item)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">final_promotion</span><span class="params">(self)</span> -&gt; str:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._finished:</span><br><span class="line">            self.charge()</span><br><span class="line">        <span class="keyword">return</span> self._final_promotion</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">discount</span><span class="params">(self)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._finished:</span><br><span class="line">            self.charge()</span><br><span class="line">        <span class="keyword">return</span> self._discount</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">total</span><span class="params">(self)</span> -&gt; int:</span></span><br><span class="line">        total = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> self.basket:</span><br><span class="line">            total += item.total</span><br><span class="line">        <span class="keyword">return</span> total</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">charge</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.promotion:</span><br><span class="line">            discount = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">with</span> Order._lock:</span><br><span class="line">                discount = self.promotion.discount(self)</span><br><span class="line">                self._finished = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.total - discount</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## Promotion</span></span><br><span class="line">PROMOS = set()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_to_promos</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="string">"""æ³¨å†Œåˆ°ä¼˜æƒ æœºåˆ¶é›†åˆ"""</span></span><br><span class="line"></span><br><span class="line">    PROMOS.add(func)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Promotion</span><span class="params">(ABC)</span>:</span></span><br><span class="line">    <span class="string">"""ä¼˜æƒ ç­–ç•¥æŠ½è±¡åŸºç±»"""</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">discount</span><span class="params">(self, order)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@add_to_promos</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FullReductionPromo</span><span class="params">(Promotion)</span>:</span></span><br><span class="line">    <span class="string">"""æ»¡30å‡6å…ƒ"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">discount</span><span class="params">(self, order)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">600</span> <span class="keyword">if</span> order.total &gt; <span class="number">3000</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@add_to_promos</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HalfPricePromo</span><span class="params">(Promotion)</span>:</span></span><br><span class="line">    <span class="string">"""æŒ‡å®šèœå“åŠä»·"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">discount</span><span class="params">(self, order)</span>:</span></span><br><span class="line">        discount = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> order.basket:</span><br><span class="line">            <span class="keyword">if</span> item.is_half_price:</span><br><span class="line">                order.half_price_items.add(item.name)</span><br><span class="line">                discount += item.total / <span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> discount</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BestPromo</span><span class="params">(Promotion)</span>:</span></span><br><span class="line">    <span class="string">"""æœ€ä½³ä¼˜æƒ """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">discount</span><span class="params">(self, order)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä½¿ç”¨è£…é¥°å™¨æ³¨å†Œä»£æ›¿</span></span><br><span class="line">        <span class="comment"># all_promotion = [</span></span><br><span class="line">        <span class="comment">#     globals()[name]</span></span><br><span class="line">        <span class="comment">#     for name in globals()</span></span><br><span class="line">        <span class="comment">#     if name.endswith("Promo") and name != "BestPromo"</span></span><br><span class="line">        <span class="comment"># ]</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> promo <span class="keyword">in</span> PROMOS:</span><br><span class="line">            discount = promo().discount(order)</span><br><span class="line">            <span class="keyword">if</span> discount != <span class="number">0</span> <span class="keyword">and</span> discount &gt; order._discount:</span><br><span class="line">                order._discount = discount</span><br><span class="line">                order._final_promotion = promo().__doc__</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> order._discount</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## utils</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">format_output</span><span class="params">(order)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    ============= è®¢é¤æ˜ç»† =============</span></span><br><span class="line"><span class="string">    é»„ç„–é¸¡ x 1 = 18å…ƒ</span></span><br><span class="line"><span class="string">    è‚‰å¤¹é¦ x 2 = 12å…ƒ</span></span><br><span class="line"><span class="string">    å‡‰çš® x 1 = 8å…ƒ</span></span><br><span class="line"><span class="string">    -----------------------------------</span></span><br><span class="line"><span class="string">    ä½¿ç”¨ä¼˜æƒ :</span></span><br><span class="line"><span class="string">    æŒ‡å®šèœå“åŠä»·(é»„ç„–é¸¡ï¼Œå‡‰çš®)ï¼Œçœ13å…ƒ</span></span><br><span class="line"><span class="string">    -----------------------------------</span></span><br><span class="line"><span class="string">    æ€»è®¡ï¼š25å…ƒ</span></span><br><span class="line"><span class="string">    ===================================</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    head = <span class="string">"============= è®¢é¤æ˜ç»† =============\n"</span></span><br><span class="line">    divide = <span class="string">"\n-----------------------------------\n"</span></span><br><span class="line">    bottom = <span class="string">"==================================="</span></span><br><span class="line"></span><br><span class="line">    items_output = <span class="string">"\n"</span>.join(</span><br><span class="line">        [</span><br><span class="line">            <span class="string">"\n"</span>.join(</span><br><span class="line">                textwrap.wrap(<span class="string">f"<span class="subst">&#123;i.name&#125;</span> x <span class="subst">&#123;i.count&#125;</span> = <span class="subst">&#123;Decimal(i.total / <span class="number">100</span>)&#125;</span>å…ƒ"</span>, <span class="number">20</span>)</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> order.basket</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">    output = head + items_output + divide</span><br><span class="line">    charge_output = <span class="string">f"æ€»è®¡ï¼š<span class="subst">&#123;Decimal(order.charge() / <span class="number">100</span>)&#125;</span>å…ƒ\n"</span></span><br><span class="line"></span><br><span class="line">    best_promo = order.final_promotion</span><br><span class="line">    <span class="keyword">if</span> best_promo == <span class="string">"æŒ‡å®šèœå“åŠä»·"</span>:</span><br><span class="line">        lines = <span class="string">"\n"</span>.join(</span><br><span class="line">            textwrap.wrap(</span><br><span class="line">                <span class="string">f"<span class="subst">&#123;best_promo&#125;</span>(<span class="subst">&#123;<span class="string">','</span>.join(order.half_price_items)&#125;</span>), çœ<span class="subst">&#123;Decimal(order.discount/<span class="number">100</span>)&#125;</span>å…ƒ"</span>,</span><br><span class="line">                <span class="number">20</span>,</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">        promotion_output = <span class="string">f"ä½¿ç”¨ä¼˜æƒ : \n<span class="subst">&#123;lines&#125;</span>"</span></span><br><span class="line">        output += promotion_output + divide</span><br><span class="line">    <span class="keyword">elif</span> best_promo == <span class="string">"æ»¡30å‡6å…ƒ"</span>:</span><br><span class="line">        promotion_output = <span class="string">f"ä½¿ç”¨ä¼˜æƒ : \n<span class="subst">&#123;best_promo&#125;</span>, çœ<span class="subst">&#123;Decimal(order.discount/<span class="number">100</span>)&#125;</span>å…ƒ"</span></span><br><span class="line">        output += promotion_output + divide</span><br><span class="line"></span><br><span class="line">    output += charge_output + bottom</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">verify_input_format</span><span class="params">(input_item: str)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    pattern = re.compile(<span class="string">r"^ITEM\d+( x )&#123;1&#125;[1-9]+"</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> pattern.match(input_item):</span><br><span class="line">        <span class="keyword">raise</span> InvalidParams(<span class="string">"è¾“å…¥æ ¼å¼æœ‰è¯¯"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_input</span><span class="params">(input_items: list)</span> -&gt; Dict[str, int]:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> input_items:</span><br><span class="line">        <span class="keyword">raise</span> EmptyInput(<span class="string">"æœªæŒ‘é€‰èœå“"</span>)</span><br><span class="line"></span><br><span class="line">    items_map = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> input_items:</span><br><span class="line">        verify_input_format(i)</span><br><span class="line">        item_id, count = i.split(<span class="string">" x "</span>)</span><br><span class="line">        <span class="keyword">if</span> item_id <span class="keyword">in</span> items_map:</span><br><span class="line">            items_map[item_id] += int(count)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            items_map[item_id] = int(count)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> items_map</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## main</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bestCharge</span><span class="params">(input_items: list)</span> -&gt; str:</span></span><br><span class="line">    items_map = parse_input(input_items)</span><br><span class="line"></span><br><span class="line">    order = Order(promotion=BestPromo())</span><br><span class="line"></span><br><span class="line">    order.add_to_basket(</span><br><span class="line">        *[Item(item_id, items_map[item_id]) <span class="keyword">for</span> item_id <span class="keyword">in</span> items_map.keys()]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> format_output(order)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    input_demo3 = [<span class="string">"ITEM0001 x 1"</span>, <span class="string">"ITEM0001 x 1"</span>, <span class="string">"ITEM0013 x 4"</span>, <span class="string">"ITEM0013 x 4"</span>]</span><br><span class="line"></span><br><span class="line">    print(bestCharge(input_demo3))</span><br></pre></td></tr></table></figure>



<p>å½“æ—¶è¿˜å†™äº†å•å…ƒæµ‹è¯•ä¸€èµ·ç»™HRå‘è¿‡å»ï¼Œå°±ä¸åœ¨è¿™å†™äº† : )</p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
</search>
